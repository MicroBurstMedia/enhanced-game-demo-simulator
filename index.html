
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Money Mission Enhanced: C-Corp + Automation Flows</title>
  <style>
    :root{
      --bg1:#667eea;--bg2:#764ba2;--card:#ffffff;--shadow:rgba(0,0,0,.2);
      --blue:#4facfe;--cyan:#00f2fe;--green:#28a745;--yellow:#ffc107;
      --red:#dc3545;--ink:#1f2937;--muted:#6b7280;--purple:#a855f7;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;
      min-height:100vh;background:linear-gradient(135deg,var(--bg1),var(--bg2));
      display:flex;align-items:center;justify-content:center;padding:18px;color:var(--ink);
    }
    .app{width:100%;max-width:1400px;background:var(--card);border-radius:22px;
      box-shadow:0 20px 60px var(--shadow);overflow:hidden;}
    header{background:linear-gradient(135deg,var(--blue),var(--cyan));padding:18px 18px 14px;
      position:relative;color:white;}
    header h1{font-size:1.7rem;text-shadow:2px 2px 4px rgba(0,0,0,.2);margin-bottom:8px;}
    header p{opacity:.95;font-size:.95rem;}
    .topbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;
      padding:12px 18px;background:#f8fafc;border-bottom:3px solid #e5e7eb;}
    .stats{display:flex;gap:14px;flex-wrap:wrap;align-items:center;}
    .stat{background:white;border:1px solid #e5e7eb;border-radius:14px;padding:10px 12px;
      min-width:130px;box-shadow:0 6px 18px rgba(0,0,0,.06);}
    .stat .value{font-size:1.2rem;font-weight:800;color:#0f172a;}
    .stat .label{font-size:.78rem;color:var(--muted);margin-top:3px;}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end;}
    .btn{border:none;cursor:pointer;padding:10px 14px;border-radius:999px;font-weight:700;
      transition:.2s;box-shadow:0 8px 22px rgba(0,0,0,.12);
      background:linear-gradient(135deg,#667eea,#764ba2);color:white;font-size:.92rem;}
    .btn:hover{transform:translateY(-2px)}
    .btn:active{transform:translateY(0)}
    .btn.secondary{background:white;color:var(--ink);border:2px solid #e5e7eb;box-shadow:none;}
    .btn.secondary:hover{border-color:#cbd5e1;transform:translateY(-1px);}
    .pill{display:flex;align-items:center;gap:8px;background:white;border:1px solid #e5e7eb;
      border-radius:999px;padding:8px 12px;font-size:.88rem;color:var(--muted);}
    .toggle{display:flex;align-items:center;gap:8px;cursor:pointer;user-select:none;}
    .switch{width:44px;height:24px;background:#cbd5e1;border-radius:999px;position:relative;
      transition:.2s;flex-shrink:0;}
    .knob{width:18px;height:18px;background:white;border-radius:50%;position:absolute;
      top:3px;left:3px;transition:.2s;box-shadow:0 4px 10px rgba(0,0,0,.18);}
    .switch.on{background:var(--green)}
    .switch.on .knob{left:23px}
    .main{display:grid;grid-template-columns:1fr 1fr;gap:18px;padding:18px;}
    @media (max-width:1100px){.main{grid-template-columns:1fr}}
    .panel{background:white;border:1px solid #e5e7eb;border-radius:18px;
      box-shadow:0 10px 28px rgba(0,0,0,.08);overflow:hidden;}
    .panel-head{padding:14px 14px 10px;border-bottom:1px solid #eef2f7;display:flex;
      align-items:center;justify-content:space-between;gap:10px;}
    .panel-head h2{font-size:1.1rem;}
    .panel-body{padding:14px;}
    .city-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;}
    .building{border-radius:16px;padding:14px;color:white;cursor:pointer;position:relative;
      overflow:hidden;transition:.2s;min-height:105px;box-shadow:0 10px 24px rgba(0,0,0,.14);}
    .building:hover{transform:translateY(-3px)}
    .building:active{transform:translateY(0)}
    .building h3{font-size:1rem;margin-bottom:6px;display:flex;gap:8px;align-items:center;}
    .building p{font-size:.88rem;opacity:.95;line-height:1.25rem;}
    .building small{display:block;margin-top:10px;opacity:.9;font-weight:700;}
    .b-parent{background:linear-gradient(135deg,#0ea5e9,#2563eb)}
    .b-operating{background:linear-gradient(135deg,#22c55e,#16a34a)}
    .b-holding{background:linear-gradient(135deg,#a855f7,#7c3aed)}
    .b-property{background:linear-gradient(135deg,#f59e0b,#f97316)}
    .b-nonprofit{background:linear-gradient(135deg,#ec4899,#db2777)}
    .flow-viz{background:#f8fafc;border:2px dashed #cbd5e1;border-radius:18px;padding:16px;margin-top:14px;}
    .flow-viz h4{font-size:.95rem;margin-bottom:10px;color:var(--ink);}
    .flow-step{background:white;border-left:4px solid var(--blue);border-radius:8px;padding:10px;
      margin-bottom:8px;display:flex;align-items:center;gap:10px;box-shadow:0 4px 12px rgba(0,0,0,.05);}
    .flow-step.active{border-left-color:var(--green);animation:pulse 1s ease infinite;}
    .flow-step .icon{font-size:1.3rem;flex-shrink:0;}
    .flow-step .text{font-size:.88rem;line-height:1.2rem;}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}
    .api-stack{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px;}
    .api-box{background:white;border:1px solid #e5e7eb;border-radius:10px;padding:8px;
      text-align:center;font-size:.8rem;box-shadow:0 4px 10px rgba(0,0,0,.04);}
    .api-box.active{background:var(--green);color:white;font-weight:700;}
    .mission-card{background:linear-gradient(135deg,#f093fb,#f5576c);color:white;
      border-radius:18px;padding:16px;box-shadow:0 12px 28px rgba(0,0,0,.15);
      margin-bottom:12px;animation:fadeUp .35s ease;}
    @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
    .mission-top{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;}
    .badge{background:rgba(255,255,255,.22);padding:7px 10px;border-radius:999px;
      font-weight:800;font-size:.85rem;backdrop-filter:blur(10px);white-space:nowrap;}
    .choices{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px;}
    .choice{background:white;color:var(--ink);border:3px solid transparent;border-radius:14px;
      padding:12px;font-weight:800;cursor:pointer;transition:.2s;text-align:left;}
    .choice:hover{border-color:#4facfe;transform:scale(1.01);box-shadow:0 8px 18px rgba(79,172,254,.25);}
    .choice:disabled{opacity:.8;cursor:not-allowed;transform:none;box-shadow:none;}
    .choice.good{background:var(--green);color:white}
    .choice.ok{background:var(--yellow);color:#1f2937}
    .choice.bad{background:var(--red);color:white}
    .feedback{margin-top:12px;padding:12px;border-radius:14px;display:none;font-weight:700;line-height:1.25rem;}
    .feedback.show{display:block;animation:fadeUp .25s ease}
    .feedback.success{background:#dcfce7;border:2px solid var(--green);color:#14532d;}
    .feedback.warn{background:#fef9c3;border:2px solid var(--yellow);color:#854d0e;}
    .feedback.error{background:#fee2e2;border:2px solid var(--red);color:#7f1d1d;}
    .coach{background:#0f172a;color:white;border-radius:18px;padding:14px;
      box-shadow:0 12px 30px rgba(0,0,0,.2);}
    .coach h3{display:flex;align-items:center;gap:8px;margin-bottom:8px;font-size:1rem;}
    .coach p{opacity:.95;font-size:.9rem;line-height:1.35rem;}
    .coach .hint{margin-top:10px;padding:10px;border-radius:14px;
      background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);display:none;}
    .coach .hint.show{display:block}
    .progress-wrap{margin-top:12px;background:#eef2ff;border-radius:999px;overflow:hidden;
      height:10px;border:1px solid #e5e7eb;}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--blue),var(--cyan));
      transition:width .35s ease;}
    .toast{position:fixed;top:-120px;right:18px;background:linear-gradient(135deg,#f093fb,#f5576c);
      color:white;padding:14px 16px;border-radius:16px;box-shadow:0 16px 40px rgba(0,0,0,.25);
      transition:top .45s ease;z-index:9999;max-width:320px;font-weight:800;}
    .toast.show{top:18px}
    .sandbox{background:#f8fafc;border:1px dashed #cbd5e1;border-radius:18px;padding:14px;}
    .sandbox h3{font-size:1rem;margin-bottom:10px;}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:10px;}
    input[type="range"]{width:100%}
    .money{font-weight:900;color:#0f172a;font-size:1.05rem;}
    .muted{color:var(--muted);font-size:.88rem}
    .divider{height:1px;background:#eef2f7;margin:12px 0}
    .tag{display:inline-flex;align-items:center;gap:6px;background:#f1f5f9;border:1px solid #e5e7eb;
      padding:6px 10px;border-radius:999px;font-size:.8rem;font-weight:800;color:#334155;}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>üéÆ Money Mission Enhanced: C-Corp + Automation</h1>
      <p>Learn C-Corp structure + Velocity Banking with real automation flow visualization.</p>
      <div class="progress-wrap" style="margin-top:10px;">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </header>

    <div class="topbar">
      <div class="stats">
        <div class="stat"><div class="value" id="stars">‚≠ê 0</div><div class="label">Stars Earned</div></div>
        <div class="stat"><div class="value" id="level">1</div><div class="label">Level</div></div>
        <div class="stat"><div class="value" id="flow">üíß Slow</div><div class="label">Money Flow</div></div>
        <div class="stat"><div class="value" id="streak">0 üî•</div><div class="label">Smart Streak</div></div>
      </div>

      <div class="controls">
        <div class="pill">
          <span class="toggle" onclick="app.toggleTurbo()">
            <span class="switch" id="turboSwitch"><span class="knob"></span></span>
            <strong>üöÄ Turbo Pay Lane</strong>
          </span>
        </div>
        <div class="pill">
          <span class="toggle" onclick="app.toggleClassroom()">
            <span class="switch" id="classSwitch"><span class="knob"></span></span>
            <strong>üè´ Classroom Mode</strong>
          </span>
        </div>
        <button class="btn secondary" onclick="app.toggleAutomation()">‚öôÔ∏è Show Automation</button>
        <button class="btn secondary" onclick="app.restart()">üîÑ Restart</button>
      </div>
    </div>

    <div class="main">
      <section class="panel">
        <div class="panel-head">
          <h2>üèôÔ∏è Business City Map</h2>
          <span class="tag" id="missionTag">Mission 1 / 7</span>
        </div>
        <div class="panel-body">
          <p class="muted">Click buildings to explore. Watch automation flows in action!</p>
          <div class="divider"></div>

          <div class="city-grid">
            <div class="building b-parent" onclick="app.openBuilding('parent')">
              <h3>üè¢ Parent Company HQ</h3>
              <p>The Brain. Plans strategy and owns other entities.</p>
              <small>Tap to learn üìò</small>
            </div>
            <div class="building b-operating" onclick="app.openBuilding('operating')">
              <h3>üè≠ Operating Company</h3>
              <p>The Worker. Earns revenue through services.</p>
              <small>Tap to learn üìò</small>
            </div>
            <div class="building b-holding" onclick="app.openBuilding('holding')">
              <h3>üè¶ Holding Vault</h3>
              <p>The Saver. Protects assets securely.</p>
              <small>Tap to learn üìò</small>
            </div>
            <div class="building b-property" onclick="app.openBuilding('property')">
              <h3>üè† Property Co</h3>
              <p>The Builder. Manages real estate.</p>
              <small>Tap to learn üìò</small>
            </div>
            <div class="building b-nonprofit" onclick="app.openBuilding('nonprofit')">
              <h3>üéì Non-Profit</h3>
              <p>The Teacher. Builds community trust.</p>
              <small>Tap to learn üìò</small>
            </div>
          </div>

          <div id="automationViz" style="display:none;">
            <div class="flow-viz">
              <h4>üîÑ Live Automation Flow</h4>
              <div id="flowSteps"></div>
              <div class="api-stack" style="margin-top:16px;">
                <div class="api-box" id="api-crm">CRM</div>
                <div class="api-box" id="api-accounting">Accounting</div>
                <div class="api-box" id="api-payment">Payment</div>
                <div class="api-box" id="api-contract">Contracts</div>
                <div class="api-box" id="api-compliance">Compliance</div>
                <div class="api-box" id="api-ai">AI Engine</div>
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="coach" id="buildingInfo">
            <h3>ü§ñ Coach Cash</h3>
            <p>Click a building to learn what it does, or start the mission on the right!</p>
            <div class="hint" id="coachHint"></div>
          </div>
        </div>
      </section>

      <aside class="panel">
        <div class="panel-head">
          <h2>üß© Mission Control</h2>
          <span class="tag" id="difficultyTag">Easy</span>
        </div>
        <div class="panel-body">
          <div id="missionArea"></div>
          <div class="divider"></div>
          <div class="sandbox">
            <h3>üß™ Sandbox: Test Your Numbers</h3>
            <p class="muted">Adjust values to see how Turbo Pay Lane optimizes flow.</p>
            <div class="row">
              <span class="tag">üí∞ Income</span>
              <span class="money" id="incomeLabel">$1000</span>
            </div>
            <input type="range" min="200" max="5000" step="100" value="1000" id="incomeRange" />
            <div class="row">
              <span class="tag">üßæ Bills</span>
              <span class="money" id="billsLabel">$600</span>
            </div>
            <input type="range" min="100" max="4500" step="100" value="600" id="billsRange" />
            <div class="divider"></div>
            <p class="muted" id="sandboxResult">Move sliders to experiment!</p>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const app={
      missionIndex:0,stars:0,streak:0,turboOn:false,classroomOn:false,automationOn:false,
      difficulty:"Easy",totalMissions:7,

      missions:[
        {title:"Client Payment Arrives!",text:"A business client pays $1,000. What do you do?",
         hint:"Fast payment routing prevents delays and late fees.",
         choices:[
           {label:"üöÄ Send through Turbo Pay Lane (CRM‚ÜíAccounting‚ÜíPayment APIs)",outcome:"good",stars:3,
            msg:"Perfect! Automated routing saved time and ensured compliance."},
           {label:"üí∏ Manual check processing (5-7 days)",outcome:"ok",stars:2,
            msg:"Works, but slower. Automation would speed this up."},
           {label:"üò¥ Wait and see",outcome:"bad",stars:0,msg:"Delays can cause cash flow problems!"}
         ]},
        {title:"Parent Company Planning",text:"Parent HQ wants new equipment. What happens?",
         hint:"Parent plans, Operating earns, automation ensures proper flow.",
         choices:[
           {label:"üè≠ Operating earns ‚Üí AI optimizes ‚Üí HQ approves",outcome:"good",stars:3,
            msg:"Correct! Automated decision support helped optimize the purchase."},
           {label:"üè¶ Holding company buys directly",outcome:"bad",stars:0,
            msg:"Wrong entity! Holding protects, doesn't purchase operations equipment."},
           {label:"üéì Non-profit funds it",outcome:"bad",stars:0,
            msg:"Non-profits can't fund business operations."}
         ]},
        {title:"Property Emergency!",text:"Pipe burst! $700 repair needed today.",
         hint:"Property company handles repairs. Turbo Pay Lane enables instant payment.",
         choices:[
           {label:"üöÄ Turbo Pay Lane ‚Üí Instant contractor payment",outcome:"good",stars:3,
            msg:"Great! Automation prevented water damage escalation."},
           {label:"‚è≥ Wait 5 days for check",outcome:"bad",stars:0,
            msg:"Water damage multiplied! Fast payment saves money."},
           {label:"üìÆ Mail check, hope it arrives",outcome:"ok",stars:1,
            msg:"Risky for emergencies. Automation is safer."}
         ]},
        {title:"Holding Vault Protection",text:"Operating made $5,000 profit. Where should it go?",
         hint:"Holding company protects profits. Automation tracks and transfers safely.",
         choices:[
           {label:"üè¶ Auto-transfer to Holding (compliance tracked)",outcome:"good",stars:3,
            msg:"Perfect! Automated tracking ensures legal separation."},
           {label:"üïπÔ∏è Spend it all on fun",outcome:"bad",stars:0,
            msg:"No business growth! Automation prevents impulsive spending."},
           {label:"üì¶ Keep in Operating indefinitely",outcome:"ok",stars:1,
            msg:"Legal risk! Entities must be kept separate."}
         ]},
        {title:"Non-Profit Workshop",text:"Host $300 community workshop?",
         hint:"Non-profit builds trust. Automated reporting ensures compliance.",
         choices:[
           {label:"üéì Approve ‚Üí Auto-log for IRS compliance",outcome:"good",stars:3,
            msg:"Excellent! Automated compliance tracking protects tax status."},
           {label:"üö´ Cancel to save money",outcome:"ok",stars:1,
            msg:"You can, but you miss trust-building opportunities."},
           {label:"üí∏ Spend with no tracking",outcome:"bad",stars:0,
            msg:"IRS violation risk! Always track non-profit expenses."}
         ]},
        {title:"Turbo Pay Challenge!",text:"Bills due tomorrow, cash is tight. What's the solution?",
         hint:"Velocity banking uses credit lines strategically for cash flow.",
         choices:[
           {label:"üöÄ Turbo Pay Lane: Use line of credit ‚Üí Pay bills ‚Üí Recover fast",outcome:"good",stars:3,
            msg:"Smart! Velocity banking kept you current and avoided late fees."},
           {label:"üßä Panic and freeze",outcome:"bad",stars:0,msg:"Panic doesn't solve problems!"},
           {label:"üê¢ Pay late, accept $50 fee",outcome:"bad",stars:0,
            msg:"$50 fee avoidable with proper cash flow management!"}
         ]},
        {title:"Final Boss: $2,500 B2B Deal",text:"Big contract! What's the best automated flow?",
         hint:"Complete flow: Client‚ÜíOperating‚ÜíRouting AI‚ÜíAll entities properly allocated.",
         choices:[
           {label:"üè≠ Client pays ‚Üí CRM triggers ‚Üí Accounting logs ‚Üí AI routes ‚Üí Entities receive",
            outcome:"good",stars:4,msg:"PERFECT! Full automation from payment to distribution!"},
           {label:"üí∏ Manual everything (2 weeks processing)",outcome:"ok",stars:1,
            msg:"It works, but you missed massive time savings."},
           {label:"üéì Non-profit collects payment",outcome:"bad",stars:0,
            msg:"Operating company handles B2B revenue!"}
         ]}
      ],

      init(){
        this.renderMission();
        this.updateStats();
        this.bindSandbox();
        this.updateProgress();
      },

      bindSandbox(){
        const incomeRange=document.getElementById("incomeRange");
        const billsRange=document.getElementById("billsRange");
        const update=()=>{
          const income=Number(incomeRange.value);
          const bills=Number(billsRange.value);
          document.getElementById("incomeLabel").textContent="$"+income.toLocaleString();
          document.getElementById("billsLabel").textContent="$"+bills.toLocaleString();
          const result=document.getElementById("sandboxResult");
          const turboBoost=this.turboOn?1.25:1.0;
          const flowScore=Math.max(0,Math.round(((income-bills)/100)*turboBoost));
          if(income<bills){
            result.textContent="‚ö†Ô∏è Bills exceed income! Lower bills or increase income.";
          }else if(this.turboOn){
            result.textContent=`üöÄ Turbo ON! Flow score: ${flowScore}. Fast routing maximizes efficiency!`;
          }else{
            result.textContent=`üíß Turbo OFF. Flow score: ${flowScore}. Enable Turbo for +25% efficiency!`;
          }
        };
        incomeRange.addEventListener("input",update);
        billsRange.addEventListener("input",update);
        update();
      },

      toggleTurbo(){
        this.turboOn=!this.turboOn;
        document.getElementById("turboSwitch").classList.toggle("on",this.turboOn);
        this.toast(this.turboOn?"üöÄ Turbo Pay Lane ACTIVE! Faster money flow!":"üíß Turbo Pay Lane OFF.");
        this.updateStats();
        this.bindSandbox();
      },

      toggleClassroom(){
        this.classroomOn=!this.classroomOn;
        document.getElementById("classSwitch").classList.toggle("on",this.classroomOn);
        const hintBox=document.getElementById("coachHint");
        if(this.classroomOn){
          hintBox.classList.add("show");
          hintBox.textContent="üè´ Hints enabled for learning!";
          this.toast("üè´ Classroom Mode ON");
        }else{
          hintBox.classList.remove("show");
          this.toast("üè´ Classroom Mode OFF");
        }
      },

      toggleAutomation(){
        this.automationOn=!this.automationOn;
        const viz=document.getElementById("automationViz");
        viz.style.display=this.automationOn?"block":"none";
        if(this.automationOn){
          this.showAutomationFlow();
          this.toast("‚öôÔ∏è Automation visualization ON");
        }else{
          this.toast("‚öôÔ∏è Automation hidden");
        }
      },

      showAutomationFlow(){
        const steps=[
          {icon:"üì±",text:"Client initiates payment via CRM",api:"crm"},
          {icon:"üîç",text:"AI verifies client credit & contract terms",api:"ai"},
          {icon:"üí≥",text:"Payment processor charges $1,000",api:"payment"},
          {icon:"üìä",text:"Accounting auto-logs transaction",api:"accounting"},
          {icon:"üìã",text:"Contract management confirms delivery",api:"contract"},
          {icon:"‚úÖ",text:"Compliance checker validates rules",api:"compliance"},
          {icon:"üè¶",text:"AI router: 70% Operating, 20% Holding, 10% Non-profit",api:"ai"}
        ];
        const container=document.getElementById("flowSteps");
        container.innerHTML=steps.map((s,i)=>
          `<div class="flow-step" id="step${i}">
            <span class="icon">${s.icon}</span>
            <span class="text">${s.text}</span>
          </div>`
        ).join("");

        let idx=0;
        const animate=()=>{
          if(idx>0){
            document.getElementById("step"+(idx-1)).classList.remove("active");
            const prevApi=steps[idx-1].api;
            if(prevApi)document.getElementById("api-"+prevApi).classList.remove("active");
          }
          if(idx<steps.length){
            document.getElementById("step"+idx).classList.add("active");
            const api=steps[idx].api;
            if(api)document.getElementById("api-"+api).classList.add("active");
            idx++;
            setTimeout(animate,1200);
          }
        };
        animate();
      },

      openBuilding(type){
        const map={
          parent:{title:"üè¢ Parent Company HQ",text:"The Brain. Owns all other entities and makes strategic decisions.",
            tip:"Strategy, not operations. Parent plans while Operating executes."},
          operating:{title:"üè≠ Operating Company",text:"The Worker. Generates revenue through B2B services.",
            tip:"Revenue source. All client payments come here first."},
          holding:{title:"üè¶ Holding Vault",text:"The Saver. Protects profits and valuable assets.",
            tip:"Asset protection. Keeps business wealth safe from operating risks."},
          property:{title:"üè† Property Company",text:"The Builder. Manages real estate and equipment.",
            tip:"Real estate specialist. Separates property liability from operations."},
          nonprofit:{title:"üéì Non-Profit",text:"The Teacher. Builds community trust and reputation.",
            tip:"Trust builder. Tax-deductible giving improves brand image."}
        };
        const info=document.getElementById("buildingInfo");
        const hint=document.getElementById("coachHint");
        info.innerHTML=`
          <h3>ü§ñ Coach Cash: ${map[type].title}</h3>
          <p>${map[type].text}</p>
          <div class="hint ${this.classroomOn?"show":""}" id="coachHint">${map[type].tip}</div>
        `;
      },

      renderMission(){
        const missionArea=document.getElementById("missionArea");
        if(this.missionIndex>=this.totalMissions){
          missionArea.innerHTML=`
            <div style="text-align:center;padding:20px;">
              <h2 style="font-size:1.5rem;margin-bottom:10px;">üéâ All Missions Complete!</h2>
              <div style="font-size:3rem;margin:14px 0;">‚≠ê ${this.stars}</div>
              <p class="muted" style="font-size:1rem;">${
                this.stars>=20?"üèÜ Business Automation Master!":
                this.stars>=14?"üåü Excellent understanding of C-Corp automation!":
                "üëè Good start! Try again for more stars!"
              }</p>
              <button class="btn" onclick="app.restart()" style="margin-top:14px;">Play Again üîÑ</button>
            </div>
          `;
          return;
        }

        const m=this.missions[this.missionIndex];
        if(this.missionIndex>=5)this.difficulty="Hard";
        else if(this.missionIndex>=3)this.difficulty="Medium";
        else this.difficulty="Easy";

        document.getElementById("difficultyTag").textContent=this.difficulty;
        document.getElementById("missionTag").textContent=`Mission ${this.missionIndex+1}/${this.totalMissions}`;

        missionArea.innerHTML=`
          <div class="mission-card">
            <div class="mission-top">
              <div style="font-weight:1000;font-size:1.05rem;">üß© ${m.title}</div>
              <div class="badge">${this.turboOn?"üöÄ Turbo ON":"üíß Normal"}</div>
            </div>
            <div style="opacity:.98;line-height:1.35rem;">${m.text}</div>
          </div>
          <div class="choices" id="choices">
            ${m.choices.map((c,idx)=>`<button class="choice" onclick="app.choose(${idx})">${c.label}</button>`).join("")}
          </div>
          <div class="feedback" id="feedbackBox"></div>
          <div class="divider"></div>
          <div class="coach">
            <h3>ü§ñ Coach Cash</h3>
            <p>${this.classroomOn?"üí° Hint: "+m.hint:"Try your best! Enable Classroom Mode for hints."}</p>
          </div>
        `;
        this.updateProgress();
      },

      choose(choiceIndex){
        const m=this.missions[this.missionIndex];
        const choice=m.choices[choiceIndex];
        const buttons=document.querySelectorAll(".choice");
        buttons.forEach(btn=>btn.disabled=true);

        let earned=choice.stars;
        if(this.turboOn&&choice.outcome==="good")earned+=1;

        if(choice.outcome==="good"){
          this.streak++;
        }else{
          this.streak=0;
        }

        this.stars+=earned;
        buttons[choiceIndex].classList.add(choice.outcome);

        const fb=document.getElementById("feedbackBox");
        fb.classList.add("show");
        if(choice.outcome==="good"){
          fb.className="feedback show success";
          fb.textContent=`‚úÖ ${choice.msg} (+${earned} ‚≠ê)`;
          if(this.streak===3)this.toast("üî• 3x Smart Streak!");
          if(this.streak===5)this.toast("üåü 5x Master Streak!");
        }else if(choice.outcome==="ok"){
          fb.className="feedback show warn";
          fb.textContent=`üü° ${choice.msg} (+${earned} ‚≠ê)`;
        }else{
          fb.className="feedback show error";
          fb.textContent=`‚ùå ${choice.msg} (+${earned} ‚≠ê)`;
        }

        this.updateStats();
        setTimeout(()=>{
          this.missionIndex++;
          this.renderMission();
        },1600);
      },

      updateStats(){
        document.getElementById("stars").textContent="‚≠ê "+this.stars;
        document.getElementById("level").textContent=Math.floor(this.stars/6)+1;
        document.getElementById("streak").textContent=this.streak+" üî•";
        let flowText="üíß Slow";
        if(this.turboOn)flowText="üöÄ Fast";
        if(this.stars>=10)flowText=this.turboOn?"üöÄ Turbo":"üíß Steady";
        if(this.stars>=18)flowText="üåä Super Flow";
        document.getElementById("flow").textContent=flowText;
      },

      updateProgress(){
        const pct=Math.min(100,Math.round((this.missionIndex/this.totalMissions)*100));
        document.getElementById("progressFill").style.width=pct+"%";
      },

      toast(text){
        const t=document.getElementById("toast");
        t.textContent=text;
        t.classList.add("show");
        setTimeout(()=>t.classList.remove("show"),2600);
      },

      restart(){
        this.missionIndex=0;this.stars=0;this.streak=0;this.difficulty="Easy";
        this.updateStats();this.renderMission();
        this.toast("üîÑ Restarted! Let's learn again!");
      }
    };

    app.init();
  </script>
</body>
</html>
